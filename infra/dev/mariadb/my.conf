# =============================================================================
# MariaDB 11 設定ファイル
# 開発・テスト環境向け（4GB RAM, 2コア, SSD, OLTP）
# claudeに生成してもらった。
# =============================================================================

[mysqld]
# -----------------------------------------------------------------------------
# 接続設定
# -----------------------------------------------------------------------------
bind-address = 0.0.0.0
port = 3306
max_connections = 25

# -----------------------------------------------------------------------------
# 文字コード設定
# -----------------------------------------------------------------------------
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# -----------------------------------------------------------------------------
# InnoDB メモリ設定（性能に大きく影響）
# -----------------------------------------------------------------------------
innodb_buffer_pool_size = 768M # データをキャッシュするメモリ（RAMの25%が目安）
innodb_log_file_size = 256M # REDOログのサイズ
innodb_log_buffer_size = 16M # ログ書き込み用バッファ
innodb_flush_log_at_trx_commit = 1 # トランザクションごとにログをフラッシュ（安全性重視）
innodb_flush_method = O_DIRECT # OSキャッシュをバイパス（二重キャッシュ防止）

# ソートやJOINで使うメモリ（1クエリあたり）
sort_buffer_size = 4M
join_buffer_size = 4M
read_buffer_size = 2M
read_rnd_buffer_size = 2M

# テンポラリテーブル
tmp_table_size = 64M
max_heap_table_size = 64M

# -----------------------------------------------------------------------------
# InnoDB 最適化設定
# -----------------------------------------------------------------------------
# SSD向け設定
innodb_io_capacity = 200
innodb_io_capacity_max = 400
innodb_read_io_threads = 2
innodb_write_io_threads = 2

# デッドロック検出
innodb_deadlock_detect = ON

# -----------------------------------------------------------------------------
# ログ設定（開発時のデバッグに便利）
# -----------------------------------------------------------------------------
# スロークエリログ（200ms以上かかったクエリをログ出力）
slow_query_log = ON
slow_query_log_file = /var/lib/mysql/slow-query.log
long_query_time = 0.2

# エラーログ
log_error = /var/lib/mysql/error.log
log_warnings = 2

# -----------------------------------------------------------------------------
# タイムゾーン設定
# -----------------------------------------------------------------------------
# UTC

# -----------------------------------------------------------------------------
# その他
# -----------------------------------------------------------------------------
# テーブル名の大文字小文字を区別しない（Linux環境でも）
lower_case_table_names = 1

# テーブル定義キャッシュ
table_open_cache = 400

# パフォーマンスモニタリング
performance_schema = ON

[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4
