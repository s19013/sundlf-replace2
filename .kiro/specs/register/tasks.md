# Implementation Plan

- [x] 1. 登録リクエストのバリデーションルールを定義する
  - ユーザー名・メールアドレス・パスワード・パスワード確認の必須チェックを定義する
  - メールアドレスのフォーマット検証と users テーブルでの一意性チェックを定義する
  - パスワードの最小文字数（8文字）と確認フィールドとの一致チェックを定義する
  - バリデーション失敗時は 422 レスポンスが自動で返されることを確認する
  - _Requirements: 1.3, 3.2, 3.3, 3.4_

- [x] 2. バックエンドにユーザー登録処理を実装する
- [x] 2.1 ユーザー作成とセッション確立のビジネスロジックを実装する
  - バリデーション済みの入力データから新しいユーザーレコードをデータベースに保存する
  - パスワードは登録時に自動でハッシュ化されることを確認する
  - 作成したユーザーでセッションを開始し、セッション固定化攻撃を防ぐためセッションを再生成する
  - 登録ユーザーの基本情報（ID・ユーザー名）をレスポンスとして返す
  - _Requirements: 3.5, 3.6_

- [x] 2.2 登録エンドポイントをコントローラとルーティングに追加する
  - 登録リクエストを受け付けてビジネスロジックに委譲するコントローラメソッドを追加する
  - POST /api/spa/register として Ziggy で参照可能なルートを登録する
  - 既存の login / logout / user エンドポイントと同じ名前空間（spa.）に含める
  - _Requirements: 3.1_

- [x] 3. APIスキーマを生成する
  - バックエンド実装完了後に `mise generate:ziggy` を実行して Ziggy ルート定義を再生成する
  - 続けて `mise generate:openapi` を実行して OpenAPI スキーマ（schema.d.ts）を再生成する
  - 生成されたスキーマに登録リクエストの型情報が含まれることを確認する
  - _Requirements: 6.1, 6.2_

- [x] 4. フロントエンドに登録API連携を実装する
- [x] 4.1 登録フォーム入力値の型定義を追加する
  - 生成済みの OpenAPI スキーマから登録フォーム入力値の型を参照して追加する
  - ログイン認証情報の型定義と同じパターンで定義する
  - _Requirements: 3.2_

- [x] 4.2 バックエンドの登録エンドポイントを呼び出す関数を追加する
  - Ziggy ルートを使って型安全な登録APIコール関数を追加する
  - ログイン API 呼び出し関数と同じパターンで実装する
  - _Requirements: 3.1_

- [x] 4.3 ストアに登録アクションを追加する
  - CSRF 保護クッキーの取得と登録 API 呼び出しを順番に行うアクションを追加する
  - 処理開始時にローディング状態を有効化し、処理終了後（成功・失敗を問わず）に解除する
  - 登録成功後にストアのユーザー情報を更新してログイン状態を確立する
  - _Requirements: 3.6, 4.1, 4.3_

- [x] 4.4 登録処理のエラーハンドリング統合関数を実装する
  - 登録処理の成功・失敗を統一した結果オブジェクトで返す関数を実装する
  - バックエンドの 422 バリデーションエラーのフィールド別メッセージを人が読めるテキストに変換する
  - ネットワーク障害や予期しないサーバーエラー時の汎用エラーメッセージを定義する
  - ログインエラーハンドリング関数と同じパターンで実装する
  - _Requirements: 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 5.2_

- [x] 5. 登録フォームの送信処理を完成させる
  - 登録フォームの TODO 部分を登録エラーハンドリング統合関数の呼び出しに置き換える
  - クライアントサイドのパスワード一致チェックを維持する
  - 登録成功時に AboutView へのルーター遷移を実装する
  - 登録失敗時にエラーメッセージをフォーム上部に表示する
  - ローディング中の送信ボタン無効化は既存の authStore.isLoading 連携で機能することを確認する
  - _Requirements: 1.1, 1.2, 1.3, 2.1, 4.2, 5.1, 5.2_

- [x] 6. テストを追加する
- [x] 6.1 (P) バリデーションルールのユニットテストを追加する
  - 各必須フィールドが空の場合に 422 エラーが返ることをテストする
  - メールアドレスの形式不正・重複時に適切なエラーが返ることをテストする
  - パスワードが 8 文字未満・確認不一致の場合に適切なエラーが返ることをテストする
  - _Requirements: 1.3, 3.2, 3.3, 3.4_

- [x] 6.2 (P) 登録APIの統合テストを追加する
  - 正しい入力データで登録すると users テーブルにレコードが作成されることを確認する
  - 登録後に認証済みユーザー取得エンドポイントが正しいユーザー情報を返すことを検証する
  - パスワードが平文でデータベースに保存されていないことを確認する
  - _Requirements: 3.5, 3.6_

- [x] 6.3 (P) フロントエンドのエラーハンドリング関数のユニットテストを追加する
  - 登録成功時に isSuccess が true で message が null であることをテストする
  - 422 エラー時にフィールド別エラーが結合されたメッセージとして返ることをテストする
  - ネットワークエラー時に isSuccess が false の汎用メッセージが返ることをテストする
  - _Requirements: 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8_
