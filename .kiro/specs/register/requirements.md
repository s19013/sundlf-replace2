# Requirements Document

## Project Description (Input)

ユーザーが新規登録できる機能を作成

### ユーザーから渡される情報

すべて必須

- ユーザー名
- email
- パスワード
- パスワード再確認

### パスワードのバリデーション

- 8文字以上

### 実装順番

- バックエンドを実装
- 以下のコマンドを実行してフロントで必要な情報を出力する
  - `mise generate:ziggy`
  - `mise generate:openapi`
- フロントエンドを実装

### ログイン後のリダイレクト先

現時点では`AboutView`を表示する

## はじめに

本ドキュメントは、Laravel + Vue 3 SPA アプリケーションにおけるユーザー新規登録機能の要件を定義する。
バックエンドは Laravel（MVC + Usecase パターン）、フロントエンドは Vue 3（FSD アーキテクチャ）で実装する。

---

## Requirements

### 要件 1: 新規登録フォームの表示

**Objective:** 未登録ユーザーとして、新規登録フォームにアクセスしたい。そうすることで、アカウントを作成してサービスを利用できるようになる。

#### 受け入れ基準

1. When ユーザーが新規登録ページにアクセスしたとき, the 新規登録機能 shall ユーザー名・メールアドレス・パスワード・パスワード確認の入力フィールドを表示する
2. The 新規登録機能 shall 登録フォームに送信ボタンを表示する
3. The 新規登録機能 shall すべての入力フィールドを必須とする

---

### 要件 2: フロントエンド入力バリデーション

**Objective:** 未登録ユーザーとして、入力内容が正しいかどうかをフォーム送信前に確認したい。そうすることで、無効なデータを送信するのを防ぐことができる。

#### 受け入れ基準

1. When 登録フォームが送信されたとき, the 新規登録機能 shall ユーザー名・メールアドレス・パスワード・パスワード確認のすべてが入力されているか検証する
2. If ユーザー名が空の場合, the 新規登録機能 shall ユーザー名は必須である旨のエラーメッセージを表示する
3. If メールアドレスが空の場合, the 新規登録機能 shall メールアドレスは必須である旨のエラーメッセージを表示する
4. If メールアドレスが有効なメール形式でない場合, the 新規登録機能 shall メールアドレスの形式が不正である旨のエラーメッセージを表示する
5. If パスワードが空の場合, the 新規登録機能 shall パスワードは必須である旨のエラーメッセージを表示する
6. If パスワードが8文字未満の場合, the 新規登録機能 shall パスワードは8文字以上必要である旨のエラーメッセージを表示する
7. If パスワード確認が空の場合, the 新規登録機能 shall パスワード確認は必須である旨のエラーメッセージを表示する
8. If パスワードとパスワード確認の値が一致しない場合, the 新規登録機能 shall パスワードが一致しない旨のエラーメッセージを表示する

---

### 要件 3: バックエンド登録APIの処理

**Objective:** システムとして、受け取った登録データを安全に検証・保存したい。そうすることで、不正なデータやアカウントの重複登録を防ぐことができる。

#### 受け入れ基準

1. The 新規登録機能 shall 登録APIエンドポイント（POST）を提供する
2. When 登録リクエストを受信したとき, the 新規登録機能 shall バックエンド側でもユーザー名・メールアドレス・パスワード・パスワード確認のバリデーションを実行する
3. If 送信されたメールアドレスがすでにデータベースに登録済みの場合, the 新規登録機能 shall メールアドレスが既に使用されている旨のエラーレスポンスを返す
4. If バックエンドバリデーションが失敗した場合, the 新規登録機能 shall 422 Unprocessable Entity レスポンスとバリデーションエラー内容を返す
5. When すべてのバリデーションが成功したとき, the 新規登録機能 shall パスワードをハッシュ化してユーザーレコードをデータベースに保存する
6. When ユーザーレコードの保存が成功したとき, the 新規登録機能 shall 自動的に認証セッションを開始する

---

### 要件 4: 二重送信の防止

**Objective:** 未登録ユーザーとして、登録ボタンを連打しても二重登録されないようにしたい。そうすることで、重複したアカウントが作成されるのを防ぐことができる。

#### 受け入れ基準

1. While 登録APIリクエストが処理中のとき, the 新規登録機能 shall 送信ボタンを無効化する
2. While 登録APIリクエストが処理中のとき, the 新規登録機能 shall ローディング状態を視覚的に表示する
3. When APIリクエストが完了したとき（成功・失敗を問わず）, the 新規登録機能 shall 送信ボタンを再び有効化する

---

### 要件 5: 登録後の画面遷移

**Objective:** 新規登録が完了したユーザーとして、登録後に適切な画面へ遷移したい。そうすることで、引き続きサービスを利用できる。

#### 受け入れ基準

1. When 登録処理が正常に完了したとき, the 新規登録機能 shall AboutView にリダイレクトする
2. When バックエンドからエラーレスポンスを受信したとき, the 新規登録機能 shall 登録フォームを表示したままエラーメッセージを画面上に表示する

---

### 要件 6: APIスキーマ生成

**Objective:** 開発チームとして、バックエンドAPI定義をフロントエンドで型安全に利用したい。そうすることで、フロントエンドとバックエンドの型の不一致を防ぐことができる。

#### 受け入れ基準

1. When 新規登録APIエンドポイントを追加したとき, the 新規登録機能 shall `mise generate:ziggy` を実行してZiggyルート定義を更新する
2. When Ziggyルート定義を更新したとき, the 新規登録機能 shall `mise generate:openapi` を実行してOpenAPIスキーマ（`schema.d.ts`）を更新する
